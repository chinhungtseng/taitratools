break_line
text
stopifnot
str_split
load_all()
str_split
library(tidyverse)
str_split
replace("1, 2, 3", " ", "")
replace
replace("1, ", " ", "")
str_replace
x <- "841720, 841869, 841891, 842111, 842121, 842122, 842211, 842219, 842230"
sep = ","
unlist(strsplit(x, sep))
x
strsplit(x, sep)
unlist(strsplit(x, sep))
tmp <- unlist(strsplit(x, sep))
tmp
strtrim(tmp)
strtrim(tmp, 6)
trimws(tmp)
tmp <- trimws(unlist(strsplit(x, sep)))
tmp
sub = 1e2
substr(tmp, 1, sub)
paste0("^", unique(tmp), collapse = "|")
str2regex <- function(x, sep = ",", sub = 1e2) {
tmp <- trimws(unlist(strsplit(x, sep)))
tmp <- substr(tmp, 1, sub)
paste0("^", unique(tmp), collapse = "|")
}
str2regex
# Split string by specify character.
#' @export
str2regex <- function(x, sep = ",", sub = 1e2) {
paste0("^", unique(
stringr::str_sub(
stringr::str_replace(
unlist(stringr::str_split(x, sep)), " ", ""),
1, sub)
), collapse = "|")
}
str2regex
str2regex <- function(x, sep = ",", sub = 1e2) {
tmp <- trimws(unlist(strsplit(x, sep)))
tmp <- substr(tmp, 1, sub)
paste0("^", unique(tmp), collapse = "|")
}
str2regex
str2regex <- function(x, sep = ",", sub = 1e2) {
tmp <- trimws(
unlist(strsplit(x, sep))
)
tmp <- substr(tmp, 1, sub)
paste0("^", unique(tmp), collapse = "|")
}
str2regex
str2regex <- function(x, sep = ",", sub = 1e2) {
tmp <- trimws(unlist(strsplit(x, sep)))
tmp <- unique(substr(tmp, 1, sub))
paste0("^", tmp, collapse = "|")
}
str2regex
load_all()
str2regex
build()
install()
gregexpr("123", "123456")
gregexpr(pattern = "123", text = "123456")
grep("123", "123456")
grep("123", "12456")
grep("123", "122456", value = TRUE)
grep("\\.csv", "123456.csv")
grep("\\.csv", "")
test <- "123456.csv"
grep("\\.csv", test)
test <- c("123456.csv", "123456.xlsx")
grep("\\.csv", test)
tt_ls()
load_all()
tt_ls()
tt_df_show("PATH_COUNTRY")
# TODO Adding some common
# tt_source_path data
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
tt_source_path <- as.list(tmp_path$path)
names(tt_source_path) <- tmp_path$name
# industry21 data
tmp_tbl <- tt_read_table(tt_get_path("PATH_INDUSTRY"))
tt_ind21_list <- c("001", "007", "018", "028", "033", "045", "050", "054", "058", "062",
"078", "083", "088", "102", "105", "106", "107", "108", "110", "115",
"120", "134", "157", "158", "174", "175", "179", "180", "184", "185",
"189", "196", "197", "198", "199", "222", "223", "224", "225", "226",
"227", "228", "229", "233", "234", "238", "239", "240", "241", "257",
"263", "298", "353", "354")
tt_ind21_tbl <- tmp_tbl[tmp_tbl[["\u7DE8\u865F"]] %in% tt_ind21_list, ][c("\u7DE8\u865F", "industry")]
save(tt_source_path, tt_ind21_tbl, tt_ind21_list, file = "R/sysdata.rda")
# tt_source_path data
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
tt_source_path <- as.list(tmp_path$path)
names(tt_source_path) <- tmp_path$name
tt_source_path
# industry21 data
tmp_tbl <- tt_read_table(tt_get_path("PATH_INDUSTRY"))
tmp_tbl
load_all()
# industry21 data
tmp_tbl <- tt_read_table(tt_get_path("PATH_INDUSTRY"))
tt_ind21_list <- c("001", "007", "018", "028", "033", "045", "050", "054", "058", "062",
"078", "083", "088", "102", "105", "106", "107", "108", "110", "115",
"120", "134", "157", "158", "174", "175", "179", "180", "184", "185",
"189", "196", "197", "198", "199", "222", "223", "224", "225", "226",
"227", "228", "229", "233", "234", "238", "239", "240", "241", "257",
"263", "298", "353", "354")
tt_ind21_tbl <- tmp_tbl[tmp_tbl[["\u7DE8\u865F"]] %in% tt_ind21_list, ][c("\u7DE8\u865F", "industry")]
save(tt_source_path, tt_ind21_tbl, tt_ind21_list, file = "R/sysdata.rda")
load_all()
tt_ls()
document()
check()
check()
install()
build()
load_all()
document()
document()
check()
tt_update_data()
load_all()
document()
document()
tt_ls()
tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tt_show_full_hscode
full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
full_hscode_tbl
View(full_hscode_tbl)
hscode <- "48231900"
full_hscode_tbl
full_hscode_tbl[c(1:2)]
full_hscode_tbl[c(3:4)]
full_hscode_tbl[c(7:8)]
full_hscode_tbl[c(9:10)]
full_hscode_tbl[c(1:2)]
c(1:2, 3:4)
list(1:2, 3:4)
lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
full_hscode_tbl[x]
})
1:10
sep
split(1:10, 2)
cut(1:10, 2)
split(1:10, sep = 2)
chunk
split(1:10)
split(1:10, cut(1:10))
cut(1:10)
split(1:10, cut(1:10, 2))
split(1:10, cut(1:10, 5))
split(1:10, cut(1:10, 5, labels = FALSE))
split(1:10, cut(seq_along(ncol(full_hscode_tbl)), 5, labels = FALSE))
ncol(full_hscode_tbl)
seq_along(ncol(full_hscode_tbl))
split(1:10, cut(seq_along(1:ncol(full_hscode_tbl)), 5, labels = FALSE))
split(seq_along(1:ncol(full_hscode_tbl)), cut(., 5, labels = FALSE))
lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
full_hscode_tbl[x]
})
1:10%%2
lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
full_hscode_tbl[x]
})
full_hscode_tbl[c(1:2)]
unique(full_hscode_tbl[c(1:2)])
lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
tmp
Reduce(rbind, tmp)
full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
Reduce(rbind, tmp)
full_hscode <- Reduce(rbind, tmp)
full_hscode
stringr::str_detect(full_hscode$hscode, hscode)
full_hscode[stringr::str_detect(full_hscode$hscode, hscode), ]
full_hscode[stringr::str_detect(full_hscode$hscode, substr(hscode1, 2)), ]
full_hscode[stringr::str_detect(full_hscode$hscode, substr(hscode, 1, 2)), ]
substr(hscode1, 2)
substr(hscode, 1, 2)
taitratools::str2regex(hscode)
str2regex
str2regex <- function(x, sep = ",", end = "", sub = 1e2) {
tmp <- trimws(unlist(strsplit(x, sep)))
tmp <- unique(substr(tmp, 1, sub))
paste0("^", tmp, end, collapse = "|")
}
str2regex(hscode)
str2regex(hscode, end = "$")
str2regex(c("48", "4823", "48231900"), end = "$")
str2regex(c("48", "4823", "48231900"))
rm(list =ls())
gc()
load_all()
str2regex(c("48", "4823", "48231900"), end = "$")
hscode
hscode <- "48231900"
hscode
length(hscode)
nchar(hscode)
full_hscode[stringr::str_detect(full_hscode$hscode, str2regex(c("48", "4823", "48231900"), end = "$")), ]
full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
full_hscode <- Reduce(rbind, tmp)
full_hscode[stringr::str_detect(full_hscode$hscode, str2regex(c("48", "4823", "48231900"), end = "$")), ]
nchar(hscode)
full_hscode
full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
full_hscode_tbl <- Reduce(rbind, tmp)
full_hscode_tbl[stringr::str_detect(full_hscode_tbl$hscode, str2regex(c("48", "4823", "48231900"), end = "$")), ]
output <- list()
output
hscode
hscode <- "48231900"
output <- list(list(hscode))
output
output <- list(hscode)
output
substr(hscode, 1, -2)
hscode
substr(hscode, -2)
substr(hscode, 1, nchar(hscode) - 2)
hscode <- substr(hscode, 1, nchar(hscode) - 2)
output <- append(output, list(hscode))
nchar(hscode)
hscode <- substr(hscode, 1, nchar(hscode) - 2)
output <- append(output, list(hscode))
output
hscode
nchar(hscode)
hscode <- substr(hscode, 1, nchar(hscode) - 2)
output <- append(output, list(hscode))
output
nchar(hscode)
nchar(hscode) > 2
substr(hscode, 1, nchar(hscode) - 2)
nchar(hscode) > 2
hscode <- "48231900"
output <- list(hscode)
nchar(hscode) > 2
hscode <- substr(hscode, 1, nchar(hscode) - 2)
while (nchar(hscode) > 2) {
hscode <- substr(hscode, 1, nchar(hscode) - 2)
output <- append(output, list(hscode))
}
output
hscode <- "8714999011"
hscode
full_hscode_tbl
full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
full_hscode_tbl
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
full_hscode_tbl <- Reduce(rbind, tmp)
hscode <- "8714999011"
output <- list(hscode)
while (nchar(hscode) > 2) {
hscode <- substr(hscode, 1, nchar(hscode) - 2)
output <- append(output, list(hscode))
}
output
hscode <- "8714999011"
output <- list(hscode)
while (nchar(hscode) > 2) {
hscode <- substr(hscode, 1, nchar(hscode) - 2)
output <- append(list(hscode), output)
}
output
unlist(output)
str2regex(unlist(output), end = "$")
patterns <- str2regex(unlist(output), end = "$")
full_hscode_tbl[stringr::str_detect(full_hscode_tbl$hscode, patterns), ]
full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
full_hscode_tbl <- Reduce(rbind, tmp)
full_hscode_tbl
.full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(.full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
.full_hscode_tbl <- Reduce(rbind, tmp)
.full_hscode_tbl
tt_update_data <- function() {
# tt_source_path data
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
tt_source_path <- as.list(tmp_path$path)
names(tt_source_path) <- tmp_path$name
# industry21 data
tmp_tbl <- tt_read_table(tt_get_path("PATH_INDUSTRY"))
tt_ind21_list <- c("001", "007", "018", "028", "033", "045", "050", "054", "058", "062",
"078", "083", "088", "102", "105", "106", "107", "108", "110", "115",
"120", "134", "157", "158", "174", "175", "179", "180", "184", "185",
"189", "196", "197", "198", "199", "222", "223", "224", "225", "226",
"227", "228", "229", "233", "234", "238", "239", "240", "241", "257",
"263", "298", "353", "354")
tt_ind21_tbl <- tmp_tbl[tmp_tbl[["\u7DE8\u865F"]] %in% tt_ind21_list, ][c("\u7DE8\u865F", "industry")]
# full hsocde data
.full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(.full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
.full_hscode_tbl <- Reduce(rbind, tmp)
save(tt_source_path, tt_ind21_tbl, tt_ind21_list, .full_hscode_tbl, file = "R/sysdata.rda")
}
tt_update_data()
load_all()
tt_hscode_show <- function() {
output <- list(hscode)
while (nchar(hscode) > 2) {
hscode <- substr(hscode, 1, nchar(hscode) - 2)
output <- append(list(hscode), output)
}
patterns <- str2regex(unlist(output), end = "$")
.full_hscode_tbl[stringr::str_detect(.full_hscode_tbl$hscode, patterns), ]
}
tt_hscode_show("01")
tt_hscode_show <- function(hscode) {
output <- list(hscode)
while (nchar(hscode) > 2) {
hscode <- substr(hscode, 1, nchar(hscode) - 2)
output <- append(list(hscode), output)
}
patterns <- str2regex(unlist(output), end = "$")
.full_hscode_tbl[stringr::str_detect(.full_hscode_tbl$hscode, patterns), ]
}
tt_hscode_show("01")
tt_hscode_show("0105")
document()
load_all()
tt_hscode_show("05")
tt_hscode_show("6813204000")
build()
load_all()
tt_ls()
load_all()
tt_hscode_show("手工具")
tt_hscode_show(chinese = "手工具")
str2regex(unlist(chinese), end = "$")
chinese = "手工具"
str2regex(unlist(chinese), end = "$")
load_all()
str2regex
str2regex(unlist(chinese), start = "", end = "")
patterns <- str2regex(unlist(chinese), start = "", end = "")
.full_hscode_tbl[stringr::str_detect(.full_hscode_tbl$hscode_cn, patterns), ]
load_all()
tt_hscode_show("手工具")
tt_hscode_show(chinese = "手工具")
tt_hscode_show(chinese = "手工具")
tt_hscode_show(chinese = "手工具")
load_all()
tt_hscode_show(chinese = "手工具")
load_all()
tt_hscode_show(chinese = "手工具")
tt_hscode_show()
#' Show hscode chinese name
#'
#' @param hscode hscode
#'
#' @return data frame
#' @export
tt_hscode_show <- function(hscode = NULL, chinese = NULL) {
if (is.null(chinese)) {
output <- list(hscode)
while (nchar(hscode) > 2) {
hscode <- substr(hscode, 1, nchar(hscode) - 2)
output <- append(list(hscode), output)
}
patterns <- str2regex(unlist(output), end = "$")
.full_hscode_tbl[stringr::str_detect(.full_hscode_tbl$hscode, patterns), ]
} else {
patterns <- str2regex(unlist(chinese), start = "", end = "")
.full_hscode_tbl[stringr::str_detect(.full_hscode_tbl$hscode_cn, patterns), ]
}
}
tt_hscode_show(chinese = "手工具")
tt_hscode_show(hscode = 850880)
tt_hscode_show(hscode = 850880)
load_all()
tt_hscode_show(hscode = 850880)
tt_hscode_show(hscode = 850880, chinese = "15")
load_all()
tt_hscode_show(hscode = 8508, chinese = "羊脂")
load_all()
tt_hscode_show(hscode = 8508, chinese = "羊脂")
tt_hscode_show(hscode = 8508, chinese = NULL)
load_all()
tt_hscode_show(hscode = 8508, chinese = "羊脂")
tt_hscode_show(hscode = 8508, chinese = NULL)
tt_hscode_show(hscode = 8508)
tt_hscode_show(chinese = "羊脂")
tt_hscode_show(hscode = 8508, chinese = "羊脂")
document()
install()
tt_hscode_show(hscode = c("15020022", "8508"))
load_all()
install()
load_all()
tt_hscode_show("0101")
install()
load_all()
.full_hscode_tbl
ddocument()
document()
tt_ind21_list
load_all()
.full_hscode_tbl
.full_hscode_tbl %>% View
View(.full_hscode_tbl)
load_all()
tt_hscode_show("84798200007")
tt_hscode_show("8479820000")
tt_hscode_show("847982000")
"84212110008"
hscode <- "84212110008"
nchar(hscode)
nchar(hscode) %% 2
nchar(hscode) %% 2 != 0
load_all()
tt_hscode_show(hscode = )
tt_hscode_show(hscode)
tt_hscode_show("842")
tt_hscode_show("8421")
tt_hscode_show("84212")
tt_hscode_show("842121")
tt_hscode_show("8421211")
tt_hscode_show("84212110")
tt_hscode_show("842121100")
tt_hscode_show("8421211000")
tt_hscode_show("84224000907")
tt_hscode_show("842240009070")
tt_hscode_show("84224000907000")
check()
tt_update_data()
load_all()
.full_hscode_tbl
check()
.full_hscode_tbl
check()
build --resave-data
build()
build() --resave-data
build()
check()
tt_update_data()
install()
toChString <- function(x = "") {
if (length(x) == 1) return(x)
paste0(
paste(x[1:length(x) - 1], collapse = "\u3001"),
"\u53ca", x[length(x)]
)
}
toChString
toChString(c("123", "456", "789"))
document()
load_all()
toChString
toChString(c("臺灣", "美國", "英國"))
check()
use_readme_rmd()
document()
check()
check()\
check()
build()
