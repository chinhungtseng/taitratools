for (i in 1:2) {
assign(paste0(".tt_ind_list_verion_", i), .industry_tbl[.industry_tbl[[paste0("reports_version_", i)]] == 1, ][["\u7DE8\u865F"]])
assign(paste0(".tt_ind_verion_", i, "_tbl"), .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% paste0(".tt_ind_list_verion_", i), ][c("\u7DE8\u865F", "industry", paste0("reports_version_", i, "_order"))])
assign(paste0(".tt_ind_verion_", i, "_tbl_en"), .industry_tbl_en[.industry_tbl_en[["\u7DE8\u865F"]] %in% paste0(".tt_ind_list_verion_", i), ][c("\u7DE8\u865F", "industry", paste0("reports_version_", i, "_order"))])
}
ls(all.names = TRUE)
.tt_ind_verion_1_tbl
tt_update_data <- function() {
# tt_source_path data -------------------------
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
.tt_source_path <- as.list(tmp_path$path)
names(.tt_source_path) <- tmp_path$name
# industry21 data -----------------------------
.industry_tbl <- tt_read_table(tt_get_path("PATH_INDUSTRY"))
.industry_tbl_en <- rlang::set_names(.industry_tbl, c("index", "type", "major", "minor", "hscode6", "hscode11", "hscode_dights",
"hscode", "industry", "reports_version_1", "reports_version_1_order", "reports_version_2",
"reports_version_2_order", "reports_version_industry21", "reports_version_industry21_order"))
.tt_ind21_list <- .industry_tbl[.industry_tbl[["reports_version_industry21"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind21_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind21_list, ][c("\u7DE8\u865F", "industry")]
.tt_ind21_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind21_list, ][c("index", "industry")]
.tt_ind_list_verion_1 <- .industry_tbl[.industry_tbl[["reports_version_1"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind_verion_1_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind_list_verion_1, ][c("\u7DE8\u865F", "industry", "reports_version_1_order")]
.tt_ind_verion_1_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind_list_verion_1, ][c("index", "industry", "reports_version_1_order")]
.tt_ind_list_verion_2 <- .industry_tbl[.industry_tbl[["reports_version_2"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind_verion_2_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind_list_verion_2, ][c("\u7DE8\u865F", "industry", "reports_version_2_order")]
.tt_ind_verion_2_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind_list_verion_2, ][c("index", "industry", "reports_version_2_order")]
# full hsocde data -----------------------------
.full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(.full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
.full_hscode_tbl <- Reduce(rbind, tmp)
# area data -------------------------------------
.area_tbl <- tt_read_table(tt_get_path("PATH_AREA"))
.area_tbl[.area_tbl$areaName == "全球", ][["countryName"]] <- "[\\w\\W]+"
# country name data -----------------------------
.country_ref_list <- readxl::read_xlsx("//172.26.1.102/dstore/重要資料/國家中英文對照.xlsx", skip = 1)
name_var <- c(
"name_ch",                                         # chinese name
paste0("mof.",         c("name", "code", "area")), # MOF
paste0("itc.",         c("name", "code")),         # ITC
paste0("world_bank.",  c("name", "code", "area")), # WORLD BANK
paste0("imf.",         c("name")),                 # IMF
paste0("oxford.",      c("name")),                 # OXFORD
paste0("un_comtrade.", c("name", "code", "iso")),  # UN COMTRADE
paste0("gta.",         c("name")),                 # GTA
paste0("itc_tariff.",  c("name")),                 # ITC TARIFF
paste0("asean.",       c("name", "code")),         # ASEAN
"name_ch2"                                         # same as name_ch
)
names(.country_ref_list) <- name_var
# save data ------------------------------------
save(
.tt_source_path, .tt_ind21_tbl, .tt_ind21_tbl_en,
.industry_tbl, .industry_tbl_en, .tt_ind21_list,
.full_hscode_tbl, .area_tbl, .country_ref_list,
.tt_ind_verion_1_tbl_en, .tt_ind_verion_2_tbl_en,
file = "R/sysdata.rda", compress='xz')
}
getsourcepath()
load_all()
# TODO Adding some common
getsourcepath <- function() {
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
.tt_source_path <- as.list(tmp_path$path)
names(.tt_source_path) <- tmp_path$name
save(.tt_source_path, file = "R/sysdata.rda", compress='xz')
}
tt_update_data <- function() {
# tt_source_path data -------------------------
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
.tt_source_path <- as.list(tmp_path$path)
names(.tt_source_path) <- tmp_path$name
# industry21 data -----------------------------
.industry_tbl <- tt_read_table(tt_get_path("PATH_INDUSTRY"))
.industry_tbl_en <- rlang::set_names(.industry_tbl, c("index", "type", "major", "minor", "hscode6", "hscode11", "hscode_dights",
"hscode", "industry", "reports_version_1", "reports_version_1_order", "reports_version_2",
"reports_version_2_order", "reports_version_industry21", "reports_version_industry21_order"))
#
#   .tt_ind21_list <- .industry_tbl[.industry_tbl[["reports_version_industry21"]] == 1, ][["\u7DE8\u865F"]]
#   .tt_ind21_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind21_list, ][c("\u7DE8\u865F", "industry")]
#   .tt_ind21_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind21_list, ][c("index", "industry")]
#
#   .tt_ind_list_verion_1 <- .industry_tbl[.industry_tbl[["reports_version_1"]] == 1, ][["\u7DE8\u865F"]]
#   .tt_ind_verion_1_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind_list_verion_1, ][c("\u7DE8\u865F", "industry", "reports_version_1_order")]
#   .tt_ind_verion_1_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind_list_verion_1, ][c("index", "industry", "reports_version_1_order")]
#
#   .tt_ind_list_verion_2 <- .industry_tbl[.industry_tbl[["reports_version_2"]] == 1, ][["\u7DE8\u865F"]]
#   .tt_ind_verion_2_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind_list_verion_2, ][c("\u7DE8\u865F", "industry", "reports_version_2_order")]
#   .tt_ind_verion_2_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind_list_verion_2, ][c("index", "industry", "reports_version_2_order")]
#
for (i in 1:2) {
assign(paste0(".tt_ind_list_verion_", i), .industry_tbl[.industry_tbl[[paste0("reports_version_", i)]] == 1, ][["\u7DE8\u865F"]])
assign(paste0(".tt_ind_verion_", i, "_tbl"), .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% paste0(".tt_ind_list_verion_", i), ][c("\u7DE8\u865F", "industry", paste0("reports_version_", i, "_order"))])
assign(paste0(".tt_ind_verion_", i, "_tbl_en"), .industry_tbl_en[.industry_tbl_en[["\u7DE8\u865F"]] %in% paste0(".tt_ind_list_verion_", i), ][c("\u7DE8\u865F", "industry", paste0("reports_version_", i, "_order"))])
}
# full hsocde data -----------------------------
.full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(.full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
.full_hscode_tbl <- Reduce(rbind, tmp)
# area data -------------------------------------
.area_tbl <- tt_read_table(tt_get_path("PATH_AREA"))
.area_tbl[.area_tbl$areaName == "全球", ][["countryName"]] <- "[\\w\\W]+"
# country name data -----------------------------
.country_ref_list <- readxl::read_xlsx("//172.26.1.102/dstore/重要資料/國家中英文對照.xlsx", skip = 1)
name_var <- c(
"name_ch",                                         # chinese name
paste0("mof.",         c("name", "code", "area")), # MOF
paste0("itc.",         c("name", "code")),         # ITC
paste0("world_bank.",  c("name", "code", "area")), # WORLD BANK
paste0("imf.",         c("name")),                 # IMF
paste0("oxford.",      c("name")),                 # OXFORD
paste0("un_comtrade.", c("name", "code", "iso")),  # UN COMTRADE
paste0("gta.",         c("name")),                 # GTA
paste0("itc_tariff.",  c("name")),                 # ITC TARIFF
paste0("asean.",       c("name", "code")),         # ASEAN
"name_ch2"                                         # same as name_ch
)
names(.country_ref_list) <- name_var
# save data ------------------------------------
save(
.tt_source_path, .tt_ind21_tbl, .tt_ind21_tbl_en,
.industry_tbl, .industry_tbl_en, .tt_ind21_list,
.full_hscode_tbl, .area_tbl, .country_ref_list,
.tt_ind_verion_1_tbl_en, .tt_ind_verion_2_tbl_en,
file = "R/sysdata.rda", compress='xz')
}
getsourcepath()
tt_update_data()
# TODO Adding some common
getsourcepath <- function() {
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
.tt_source_path <- as.list(tmp_path$path)
names(.tt_source_path) <- tmp_path$name
save(.tt_source_path, file = "R/sysdata.rda", compress='xz')
}
tt_update_data <- function() {
# tt_source_path data -------------------------
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
.tt_source_path <- as.list(tmp_path$path)
names(.tt_source_path) <- tmp_path$name
# industry21 data -----------------------------
.industry_tbl <- tt_read_table(tt_get_path("PATH_INDUSTRY"))
.industry_tbl_en <- rlang::set_names(.industry_tbl, c("index", "type", "major", "minor", "hscode6", "hscode11", "hscode_dights",
"hscode", "industry", "reports_version_1", "reports_version_1_order", "reports_version_2",
"reports_version_2_order", "reports_version_industry21", "reports_version_industry21_order"))
.tt_ind21_list <- .industry_tbl[.industry_tbl[["reports_version_industry21"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind21_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind21_list, ][c("\u7DE8\u865F", "industry")]
.tt_ind21_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind21_list, ][c("index", "industry")]
.tt_ind_list_verion_1 <- .industry_tbl[.industry_tbl[["reports_version_1"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind_verion_1_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind_list_verion_1, ][c("\u7DE8\u865F", "industry", "reports_version_1_order")]
.tt_ind_verion_1_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind_list_verion_1, ][c("index", "industry", "reports_version_1_order")]
.tt_ind_list_verion_2 <- .industry_tbl[.industry_tbl[["reports_version_2"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind_verion_2_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind_list_verion_2, ][c("\u7DE8\u865F", "industry", "reports_version_2_order")]
.tt_ind_verion_2_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind_list_verion_2, ][c("index", "industry", "reports_version_2_order")]
#
#   for (i in 1:2) {
#     assign(paste0(".tt_ind_list_verion_", i), .industry_tbl[.industry_tbl[[paste0("reports_version_", i)]] == 1, ][["\u7DE8\u865F"]])
#     assign(paste0(".tt_ind_verion_", i, "_tbl"), .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% paste0(".tt_ind_list_verion_", i), ][c("\u7DE8\u865F", "industry", paste0("reports_version_", i, "_order"))])
#     assign(paste0(".tt_ind_verion_", i, "_tbl_en"), .industry_tbl_en[.industry_tbl_en[["\u7DE8\u865F"]] %in% paste0(".tt_ind_list_verion_", i), ][c("\u7DE8\u865F", "industry", paste0("reports_version_", i, "_order"))])
#   }
# full hsocde data -----------------------------
.full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(.full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
.full_hscode_tbl <- Reduce(rbind, tmp)
# area data -------------------------------------
.area_tbl <- tt_read_table(tt_get_path("PATH_AREA"))
.area_tbl[.area_tbl$areaName == "全球", ][["countryName"]] <- "[\\w\\W]+"
# country name data -----------------------------
.country_ref_list <- readxl::read_xlsx("//172.26.1.102/dstore/重要資料/國家中英文對照.xlsx", skip = 1)
name_var <- c(
"name_ch",                                         # chinese name
paste0("mof.",         c("name", "code", "area")), # MOF
paste0("itc.",         c("name", "code")),         # ITC
paste0("world_bank.",  c("name", "code", "area")), # WORLD BANK
paste0("imf.",         c("name")),                 # IMF
paste0("oxford.",      c("name")),                 # OXFORD
paste0("un_comtrade.", c("name", "code", "iso")),  # UN COMTRADE
paste0("gta.",         c("name")),                 # GTA
paste0("itc_tariff.",  c("name")),                 # ITC TARIFF
paste0("asean.",       c("name", "code")),         # ASEAN
"name_ch2"                                         # same as name_ch
)
names(.country_ref_list) <- name_var
# save data ------------------------------------
save(
.tt_source_path, .tt_ind21_tbl, .tt_ind21_tbl_en,
.industry_tbl, .industry_tbl_en, .tt_ind21_list,
.full_hscode_tbl, .area_tbl, .country_ref_list,
.tt_ind_verion_1_tbl_en, .tt_ind_verion_2_tbl_en,
file = "R/sysdata.rda", compress='xz')
}
getsourcepath()
tt_update_data()
load_all()
rm(list = ls())
gc()
load_all()
.tt_ind_verion_1_tbl_en
# TODO Adding some common
getsourcepath <- function() {
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
.tt_source_path <- as.list(tmp_path$path)
names(.tt_source_path) <- tmp_path$name
save(.tt_source_path, file = "R/sysdata.rda", compress='xz')
}
tt_update_data <- function() {
# tt_source_path data -------------------------
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
.tt_source_path <- as.list(tmp_path$path)
names(.tt_source_path) <- tmp_path$name
# industry21 data -----------------------------
.industry_tbl <- tt_read_table(tt_get_path("PATH_INDUSTRY"))
.industry_tbl_en <- rlang::set_names(.industry_tbl, c("index", "type", "major", "minor", "hscode6", "hscode11", "hscode_dights",
"hscode", "industry", "reports_version_1", "reports_version_1_order", "reports_version_2",
"reports_version_2_order", "reports_version_industry21", "reports_version_industry21_order"))
.tt_ind21_list <- .industry_tbl[.industry_tbl[["reports_version_industry21"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind21_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind21_list, ][c("\u7DE8\u865F", "industry", "reports_version_industry21_order")]
.tt_ind21_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind21_list, ][c("index", "industry", "reports_version_industry21_order")]
.tt_ind_list_verion_1 <- .industry_tbl[.industry_tbl[["reports_version_1"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind_verion_1_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind_list_verion_1, ][c("\u7DE8\u865F", "industry", "reports_version_1_order")]
.tt_ind_verion_1_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind_list_verion_1, ][c("index", "industry", "reports_version_1_order")]
.tt_ind_list_verion_2 <- .industry_tbl[.industry_tbl[["reports_version_2"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind_verion_2_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind_list_verion_2, ][c("\u7DE8\u865F", "industry", "reports_version_2_order")]
.tt_ind_verion_2_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind_list_verion_2, ][c("index", "industry", "reports_version_2_order")]
# full hsocde data -----------------------------
.full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(.full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
.full_hscode_tbl <- Reduce(rbind, tmp)
# area data -------------------------------------
.area_tbl <- tt_read_table(tt_get_path("PATH_AREA"))
.area_tbl[.area_tbl$areaName == "全球", ][["countryName"]] <- "[\\w\\W]+"
# country name data -----------------------------
.country_ref_list <- readxl::read_xlsx("//172.26.1.102/dstore/重要資料/國家中英文對照.xlsx", skip = 1)
name_var <- c(
"name_ch",                                         # chinese name
paste0("mof.",         c("name", "code", "area")), # MOF
paste0("itc.",         c("name", "code")),         # ITC
paste0("world_bank.",  c("name", "code", "area")), # WORLD BANK
paste0("imf.",         c("name")),                 # IMF
paste0("oxford.",      c("name")),                 # OXFORD
paste0("un_comtrade.", c("name", "code", "iso")),  # UN COMTRADE
paste0("gta.",         c("name")),                 # GTA
paste0("itc_tariff.",  c("name")),                 # ITC TARIFF
paste0("asean.",       c("name", "code")),         # ASEAN
"name_ch2"                                         # same as name_ch
)
names(.country_ref_list) <- name_var
# save data ------------------------------------
save(
.tt_source_path, .tt_ind21_tbl, .tt_ind21_tbl_en,
.industry_tbl, .industry_tbl_en, .tt_ind21_list,
.full_hscode_tbl, .area_tbl, .country_ref_list,
.tt_ind_verion_1_tbl_en, .tt_ind_verion_2_tbl_en,
file = "R/sysdata.rda", compress='xz')
}
getsourcepath()
tt_update_data()
load_all()
.tt_ind21_tbl
.mof_sample_data <- tt_vroom_mof("2019-01", "2019-03", period = 3, dep_month_cols = TRUE)
.mof_sample_data
# TODO Adding some common
getsourcepath <- function() {
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
.tt_source_path <- as.list(tmp_path$path)
names(.tt_source_path) <- tmp_path$name
save(.tt_source_path, file = "R/sysdata.rda", compress='xz')
}
tt_update_data <- function() {
# tt_source_path data -------------------------
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
.tt_source_path <- as.list(tmp_path$path)
names(.tt_source_path) <- tmp_path$name
# industry data -----------------------------
.industry_tbl <- tt_read_table(tt_get_path("PATH_INDUSTRY"))
.industry_tbl_en <- rlang::set_names(.industry_tbl, c("index", "type", "major", "minor", "hscode6", "hscode11", "hscode_dights",
"hscode", "industry", "reports_version_1", "reports_version_1_order", "reports_version_2",
"reports_version_2_order", "reports_version_industry21", "reports_version_industry21_order"))
# industry21 data -----------------------------
.tt_ind21_list <- .industry_tbl[.industry_tbl[["reports_version_industry21"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind21_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind21_list, ][c("\u7DE8\u865F", "industry", "reports_version_industry21_order")]
.tt_ind21_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind21_list, ][c("index", "industry", "reports_version_industry21_order")]
# industry version 1 data -----------------------------
.tt_ind_list_verion_1 <- .industry_tbl[.industry_tbl[["reports_version_1"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind_verion_1_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind_list_verion_1, ][c("\u7DE8\u865F", "industry", "reports_version_1_order")]
.tt_ind_verion_1_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind_list_verion_1, ][c("index", "industry", "reports_version_1_order")]
# industry version 2 data -----------------------------
.tt_ind_list_verion_2 <- .industry_tbl[.industry_tbl[["reports_version_2"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind_verion_2_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind_list_verion_2, ][c("\u7DE8\u865F", "industry", "reports_version_2_order")]
.tt_ind_verion_2_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind_list_verion_2, ][c("index", "industry", "reports_version_2_order")]
# full hsocde data -----------------------------
.full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(.full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
.full_hscode_tbl <- Reduce(rbind, tmp)
# area data -------------------------------------
.area_tbl <- tt_read_table(tt_get_path("PATH_AREA"))
.area_tbl[.area_tbl$areaName == "全球", ][["countryName"]] <- "[\\w\\W]+"
# country name data -----------------------------
.country_ref_list <- readxl::read_xlsx("//172.26.1.102/dstore/重要資料/國家中英文對照.xlsx", skip = 1)
name_var <- c(
"name_ch",                                         # chinese name
paste0("mof.",         c("name", "code", "area")), # MOF
paste0("itc.",         c("name", "code")),         # ITC
paste0("world_bank.",  c("name", "code", "area")), # WORLD BANK
paste0("imf.",         c("name")),                 # IMF
paste0("oxford.",      c("name")),                 # OXFORD
paste0("un_comtrade.", c("name", "code", "iso")),  # UN COMTRADE
paste0("gta.",         c("name")),                 # GTA
paste0("itc_tariff.",  c("name")),                 # ITC TARIFF
paste0("asean.",       c("name", "code")),         # ASEAN
"name_ch2"                                         # same as name_ch
)
names(.country_ref_list) <- name_var
.mof_export_usd_sample_data <- tt_vroom_mof("2019-01", "2019-03", period = 3, dep_month_cols = TRUE)
# save data ------------------------------------
save(
.tt_source_path, .tt_ind21_tbl, .tt_ind21_tbl_en,
.industry_tbl, .industry_tbl_en, .tt_ind21_list,
.full_hscode_tbl, .area_tbl, .country_ref_list,
.tt_ind_verion_1_tbl_en, .tt_ind_verion_2_tbl_en,
.mof_export_usd_sample_data,
file = "R/sysdata.rda", compress='xz')
}
getsourcepath()
tt_update_data()
rm(list = ls())
gc()
load_all()
# TODO Adding some common
getsourcepath <- function() {
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
.tt_source_path <- as.list(tmp_path$path)
names(.tt_source_path) <- tmp_path$name
save(.tt_source_path, file = "R/sysdata.rda", compress='xz')
}
tt_update_data <- function() {
# tt_source_path data -------------------------
tmp_path <- readxl::read_xlsx("inst/extdata/tt_source_path.xlsx")
.tt_source_path <- as.list(tmp_path$path)
names(.tt_source_path) <- tmp_path$name
# industry data -----------------------------
.industry_tbl <- tt_read_table(tt_get_path("PATH_INDUSTRY"))
.industry_tbl_en <- rlang::set_names(.industry_tbl, c("index", "type", "major", "minor", "hscode6", "hscode11", "hscode_dights",
"hscode", "industry", "reports_version_1", "reports_version_1_order", "reports_version_2",
"reports_version_2_order", "reports_version_industry21", "reports_version_industry21_order"))
# industry21 data -----------------------------
.tt_ind21_list <- .industry_tbl[.industry_tbl[["reports_version_industry21"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind21_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind21_list, ][c("\u7DE8\u865F", "industry", "reports_version_industry21_order")]
.tt_ind21_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind21_list, ][c("index", "industry", "reports_version_industry21_order")]
# industry version 1 data -----------------------------
.tt_ind_list_verion_1 <- .industry_tbl[.industry_tbl[["reports_version_1"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind_verion_1_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind_list_verion_1, ][c("\u7DE8\u865F", "industry", "reports_version_1_order")]
.tt_ind_verion_1_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind_list_verion_1, ][c("index", "industry", "reports_version_1_order")]
# industry version 2 data -----------------------------
.tt_ind_list_verion_2 <- .industry_tbl[.industry_tbl[["reports_version_2"]] == 1, ][["\u7DE8\u865F"]]
.tt_ind_verion_2_tbl <- .industry_tbl[.industry_tbl[["\u7DE8\u865F"]] %in% .tt_ind_list_verion_2, ][c("\u7DE8\u865F", "industry", "reports_version_2_order")]
.tt_ind_verion_2_tbl_en <- .industry_tbl_en[.industry_tbl_en[["index"]] %in% .tt_ind_list_verion_2, ][c("index", "industry", "reports_version_2_order")]
# full hsocde data -----------------------------
.full_hscode_tbl <- tt_read_table(tt_get_path("PATH_FULL_HSCODE"))
tmp <- lapply(list(1:2, 3:4, 5:6, 7:8, 9:10), function(x) {
tmp <- unique(.full_hscode_tbl[x])
names(tmp) <- c("hscode", "hscode_cn")
tmp
})
.full_hscode_tbl <- Reduce(rbind, tmp)
# area data -------------------------------------
.area_tbl <- tt_read_table(tt_get_path("PATH_AREA"))
.area_tbl[.area_tbl$areaName == "全球", ][["countryName"]] <- "[\\w\\W]+"
# country name data -----------------------------
.country_ref_list <- readxl::read_xlsx("//172.26.1.102/dstore/重要資料/國家中英文對照.xlsx", skip = 1)
name_var <- c(
"name_ch",                                         # chinese name
paste0("mof.",         c("name", "code", "area")), # MOF
paste0("itc.",         c("name", "code")),         # ITC
paste0("world_bank.",  c("name", "code", "area")), # WORLD BANK
paste0("imf.",         c("name")),                 # IMF
paste0("oxford.",      c("name")),                 # OXFORD
paste0("un_comtrade.", c("name", "code", "iso")),  # UN COMTRADE
paste0("gta.",         c("name")),                 # GTA
paste0("itc_tariff.",  c("name")),                 # ITC TARIFF
paste0("asean.",       c("name", "code")),         # ASEAN
"name_ch2"                                         # same as name_ch
)
names(.country_ref_list) <- name_var
.mof_export_usd_sample_data <- tt_vroom_mof("2019-01", "2019-02", period = 3, dep_month_cols = TRUE)
# save data ------------------------------------
save(
.tt_source_path, .tt_ind21_tbl, .tt_ind21_tbl_en,
.industry_tbl, .industry_tbl_en, .tt_ind21_list,
.full_hscode_tbl, .area_tbl, .country_ref_list,
.tt_ind_verion_1_tbl_en, .tt_ind_verion_2_tbl_en,
.mof_export_usd_sample_data,
file = "R/sysdata.rda", compress='xz')
}
getsourcepath()
tt_update_data()
load_all()
.mof_export_usd_sample_data
install()
library(taitratools)
build()
load_all()
.mof_export_usd_sample_data %>% ttt_bind_industry(ind21 = TRUE)
.mof_export_usd_sample_data %>% tt_bind_industry(ind21 = TRUE)
valid_tbl <- .tt_ind21_tbl
valid_tbl
valid_tbl[["\u7DE8\u865F"]]
tmp_tbl <- .industry_tbl
tmp_tbl
check_ind21(tmp_tbl)
.df <- tmp_tbl
# User's data.
check_tbl <- .df
check_tbl[["\u7DE8\u865F"]]
tmp_tbl
.tt_ind21_tbl
valid_tbl
check_tbl
tmp_tbl
tmp_tbl <- .industry_tbl
tmp_tbl
.tt_ind21_tbl
check_tbl
valid_tbl
"\u7DE8\u865F"
check_tbl[check_tbl[["\u7DE8\u865F"]]
check_tbl[["\u7DE8\u865F"]]
check_tbl[["\u7DE8\u865F"]] %in% valid_tbl[["\u7DE8\u865F"]]
check_tbl[check_tbl[["\u7DE8\u865F"]] %in% valid_tbl[["\u7DE8\u865F"]], ]
# Extract industry 21 with same rule as prestore data.
check_tbl <- check_tbl[check_tbl[["\u7DE8\u865F"]] %in% valid_tbl[["\u7DE8\u865F"]], ]
check_tbl
check_tbl <- check_tbl[c("\u7DE8\u865F", "industry", "reports_version_industry21_order")]
identical(valid_tbl, check_tbl)
check_ind21 <- function(.df) {
# Package prestore industry 21 data.
valid_tbl <- .tt_ind21_tbl
# User's data.
check_tbl <- .df
# Extract industry 21 with same rule as prestore data.
check_tbl <- check_tbl[check_tbl[["\u7DE8\u865F"]] %in% valid_tbl[["\u7DE8\u865F"]], ]
check_tbl <- check_tbl[c("\u7DE8\u865F", "industry", "reports_version_industry21_order")]
# If two data are same, return TRUE, else return FALSE.
return(identical(valid_tbl, check_tbl))
}
rm(list = ls())
gc()
load_all()
.mof_export_usd_sample_data %>% tt_bind_industry(ind21 = TRUE)
document()
check()
install()
build()
c(
"\u8CA1\u653F\u90E8\u5B9A\u7FA9\u7522\u696D",
"\u5176\u4ED6\u7522\u696D\u5B9A\u7FA9", "5+2\u7522\u696D",
"BEC", "\u5168\u90E8\u7522\u54C1",
"\u8CA1\u653F\u90E8\u5B9A\u7FA9\u7522\u696D-54\u7D30\u9805"
)
load_all()
.industry_tbl_en
tmp_tbl <- .industry_tbl_en
tmp_tbl
"\u7DE8\u865F"
.tt_ind21_list
tmp_tbl[tmp_tbl[["index"]] %in% .tt_ind21_list, ]
"\u7DE8\u865F"
type_for_check
c(
"\u8CA1\u653F\u90E8\u5B9A\u7FA9\u7522\u696D",
"\u5176\u4ED6\u7522\u696D\u5B9A\u7FA9", "5+2\u7522\u696D",
"BEC", "\u5168\u90E8\u7522\u54C1",
"\u8CA1\u653F\u90E8\u5B9A\u7FA9\u7522\u696D-54\u7D30\u9805"
)
"\u9078\u64C7\u65B9\u5F0F"]
"\u9078\u64C7\u65B9\u5F0F"
tmp_tbl
"\u5927\u9805"
"\u5927\u9805"
"\u7D30\u9805"
c("\u9078\u64C7\u65B9\u5F0F", "\u5927\u9805", "\u7D30\u9805", "hscode", "industry")
"\u9078\u64C7\u65B9\u5F0F"
"\u7DE8\u865F"
.tt_ind21_tbl
load_all()
load_all()
.mof_export_usd_sample_data %>% tt_bind_country(ind21 = TRUE)
.mof_export_usd_sample_data %>% tt_bind_industry(ind21 = TRUE)
.industry_tbl_en
load_all()
.mof_export_usd_sample_data %>% tt_bind_industry(ind21 = TRUE)
install()
build()
